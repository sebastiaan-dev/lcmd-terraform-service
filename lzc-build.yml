# 整个文件中，可以通过 ${var} 的方式，使用 manifest 字段指定的文件定义的值

# buildscript
# - 可以为构建脚本的路径地址
# - 如果构建命令简单，也可以直接写 sh 的命令
buildscript: sh build.sh

# manifest: 指定 lpk 包的 manifest.yml 文件路径
manifest: ./lzc-manifest.yml

# contentdir: 指定打包的内容，将会打包到 lpk 中
contentdir: ./dist

# pkgout: lpk 包的输出路径
pkgout: ./

# icon 指定 lpk 包 icon 的路径路径，如果不指定将会警告
# icon 仅仅允许 png 后缀的文件
icon: ./lzc-icon.png

# dvshell 指定开发依赖的情况
# 这种情况下，选用 alpine:latest 作为基础镜像，在 dependencies 中添加所需要的开发依赖即可
# 如果 dependencies 和 build 同时存在，将会优先使用 dependencies
devshell:
  routes:
    - /=http://127.0.0.1:5173
  dependencies:
    - nodejs
    - npm
  setupscript: |
    sh -c 'echo "https://dl-cdn.alpinelinux.org/alpine/v3.19/main" > /etc/apk/repositories'
    sh -c 'echo "https://dl-cdn.alpinelinux.org/alpine/v3.19/community" >> /etc/apk/repositories'
    apk update

    apk add go nodejs npm

    npm install -g corepack
    corepack enable

    TF_VERSION=1.14.0; \
    if ! command -v terraform >/dev/null 2>&1 || ! terraform version 2>/dev/null | grep -q "Terraform v$TF_VERSION"; then \
      wget -q "https://releases.hashicorp.com/terraform/${TF_VERSION}/terraform_${TF_VERSION}_linux_amd64.zip" && \
      unzip -o "terraform_${TF_VERSION}_linux_amd64.zip" -d /usr/local/bin/ && \
      chmod +x /usr/local/bin/terraform && \
      echo "Installed Terraform $(terraform version | head -n1)"; \
    else \
      echo "Terraform v${TF_VERSION} already installed."; \
    fi

    export GOBIN=$GOPATH/bin

    printf '%s\n' 'provider_installation {' '' '  dev_overrides {' '    "non-existent.nl/edu/lcmd" = "$GOBIN"' '  }' '' '  direct {}' '}' > source.tfrc && export TERRAFORM_CONFIG="$(pwd)/source.tfrc"
    export TF_LOG=TRACE
    export GOTOOLCHAIN=auto
